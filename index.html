<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Doghaus Tap List</title>

<style>
body {
  margin:0;
  background:black;
  color:white;
  font-family: Arial, Helvetica, sans-serif;
  overflow:hidden;
}

.slide {
  position:absolute;
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;
  padding:80px;
  box-sizing:border-box;
  opacity:0;
  transition:opacity 1s ease;
}

.active {
  opacity:1;
}

h1 {
  font-size:70px;
  letter-spacing:6px;
  margin:10px 0;
}

h2 {
  font-size:40px;
  margin:10px 0;
}

.tap-list {
  font-size:28px;
  line-height:1.8em;
  margin-top:40px;
}

.feature-name {
  font-size:60px;
  letter-spacing:4px;
  margin-bottom:30px;
}

.feature-meta {
  font-size:28px;
  margin:10px 0;
}

.feature-desc {
  font-size:24px;
  max-width:900px;
  line-height:1.6em;
  margin-top:30px;
}

.small {
  font-size:28px;
  letter-spacing:4px;
}
</style>
</head>

<body>

<div id="slides"></div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<script>
const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTPnY0Eil58qxwrh7by-TbNSfe_-ektLbbc335mtKbXSVhTT2yVbndET5kqKAgHphA9x_qqx9UYDKRi/pub?output=csv";

let slides = [];
let currentIndex = 0;
let currentDataHash = "";

async function fetchData() {
  const response = await fetch(SHEET_URL + "&cacheBust=" + Date.now());
  const text = await response.text();

  return new Promise(resolve => {
    Papa.parse(text, {
      header: true,
      skipEmptyLines: true,
      complete: function(results) {
        resolve(results.data);
      }
    });
  });
}

function buildSlides(data) {

  const container = document.getElementById("slides");
  container.innerHTML = "";

  data = data
    .filter(b => b.TapNumber)
    .sort((a,b)=> Number(a.TapNumber) - Number(b.TapNumber));

  // TITLE SLIDE
  container.innerHTML += `
    <div class="slide">
      <h1>WELCOME TO</h1>
      <h1>THE DOGHAUS</h1>
      <div class="small">SIT.</div>
      <div class="small">STAY.</div>
      <div class="small">SIP.</div>
      <div class="small" style="margin-top:30px;">BREWED FOR THE PACK</div>
    </div>
  `;

  // WHAT'S ON TAP SLIDE
  const onTap = data.filter(b => b.Status === "On Tap");

  let tapHTML = onTap.map(b => `
    <div>
      ${b.Style} | ${b.ABV}% ABV | ${b.IBU} IBU<br>
      <strong>${b.BeerName}</strong>
    </div>
  `).join("<br>");

  container.innerHTML += `
    <div class="slide">
      <h2>WHAT'S ON TAP</h2>
      <div class="tap-list">${tapHTML}</div>
    </div>
  `;

  // FEATURE SLIDES
  const features = data.filter(b => b.Feature === "TRUE");

  features.forEach(b => {
    container.innerHTML += `
      <div class="slide">
        <div class="feature-name">${b.BeerName.toUpperCase()}</div>
        <div class="feature-meta">STYLE: ${b.Style.toUpperCase()}</div>
        <div class="feature-meta">ABV: ${b.ABV}%</div>
        <div class="feature-meta">IBU: ${b.IBU}</div>
        <div class="feature-desc">${b.Description}</div>
      </div>
    `;
  });

  slides = document.querySelectorAll(".slide");
  currentIndex = 0;
}

function showNextSlide() {
  if (!slides.length) return;
  slides.forEach(s => s.classList.remove("active"));
  slides[currentIndex].classList.add("active");
  currentIndex = (currentIndex + 1) % slides.length;
}

async function refreshData() {
  const data = await fetchData();
  const newHash = JSON.stringify(data);

  if (newHash !== currentDataHash) {
    currentDataHash = newHash;
    buildSlides(data);
  }
}

async function init() {
  const data = await fetchData();
  currentDataHash = JSON.stringify(data);
  buildSlides(data);
  slides = document.querySelectorAll(".slide");
  if (slides.length) slides[0].classList.add("active");
  setInterval(showNextSlide, 8000);
  setInterval(refreshData, 10000);
}

init();
</script>

</body>
</html>
